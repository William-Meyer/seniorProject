<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body id = "body">
    <h1 id="out" onclick="update()">Test</h1>
    <canvas id="canvas" width="480" height="480">
      Please use a browser that supports HTML5 Canvas.
    </canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    var socket = io();
    //alert function from server
    socket.on('serverAlert',function(msg){
      alert('Server Alert: ' + msg);
    });

    //game logic below
    class Camera{
      constructor(x,y){
        this.x =x;
        this.y = y;
        this.width = canvas.width;
        this.height = canvas.height;
      }
    }
    class Sprite{
      constructor(x,y,scale,src){
        this.x = x;
        this.y = y;
        this.scale = scale;
        this.src = src;
        this.img = document.createElement("img");
        this.img.src = src;
        //document.getElementById('body').appendChild(this.img);
      }
      drawSprite(ctx){
        console.log(this.img.src + ' moving');

        ctx.drawImage(this.img, cam.width/2-cam.x+this.x, cam.height/2-cam.y+this.y);
      }
    }
    //--------------------------------------
    //basic set up
    let clientSprites = [];//list to keep track of sprite info on the client end
    //--Setting up canvas
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.fillStyle = "blue";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    //--
    var cam = new Camera(270,240)//init camera at the cords in params
    const scaleConst = 1;
    //--------------------------------------
    function update(){
      ctx.fillStyle = "blue";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      clientSprites[0].drawSprite(ctx);
    }
    socket.on('updateClientSprites',function(list){
      for(let i=0; i<list.length; i++){
        alert('creating Sprites');
        clientSprites.push(new Sprite(list[i].x,list[i].y,scaleConst,list[i].src));
        console.log('client Sprites init: '+clientSprites);
        clientSprites[i].drawSprite(ctx);
      }
    });
    socket.on('moveSprite',function(index,dX,dY){
      clientSprites[index].x = dX;
      clientSprites[index].y = dY;
      update();//NOTICE NEEDS TO CHANGE LATER !!RECURSION WARNIN!!
    });
    //will be cahnged into update loop
    document.onkeypress = function (e) {
    e = e || window.event;
    socket.emit('move')
    // use e.keyCode
    };
    </script>
  </body>
</html>
