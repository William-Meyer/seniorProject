<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body id = "body">
    <h1 id="out" onclick="update()">Test</h1>
    <canvas id="canvas" width="480" height="480">
      Please use a browser that supports HTML5 Canvas.
    </canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    var socket = io();
    let clientSprites = [];
    const scaleConst =1;
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.fillStyle = "blue";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    class Sprite{
      constructor(x,y,scale,src){
        this.x = x;
        this.y = y;
        this.scale = scale;
        this.src = src;
        this.img = document.createElement("img");
        this.img.src = src;
        //document.getElementById('body').appendChild(this.img);
      }
      drawSprite(ctx){
        console.log(this.img.src + ' moving');

        ctx.drawImage(this.img, this.x, this.y);
      }
    }
    socket.on('serverAlert',function(msg){
      alert('Server Alert: ' + msg);
    });
    function update(){
      ctx.fillStyle = "blue";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      clientSprites[0].drawSprite(ctx);
    }
    socket.on('updateClientSprites',function(list){
      for(let i=0; i<list.length; i++){
        alert('creating Sprites');
        clientSprites.push(new Sprite(list[i].x,list[i].y,scaleConst,list[i].src));
        console.log('client Sprites init: '+clientSprites);
        clientSprites[i].drawSprite(ctx);
      }
    });
    socket.on('moveSprite',function(index,dX,dY){
      clientSprites[index].x = dX;
      clientSprites[index].y = dY;
      update();
    });
    document.onkeypress = function (e) {
    e = e || window.event;
    socket.emit('move')
    // use e.keyCode
};
// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel
// MIT license

function initGame(){
//get all sprites from node
//initiate front end sprites based on that info
}
    </script>
  </body>
</html>
